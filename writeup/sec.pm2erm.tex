\section{Integration of Plate Models and Entity Relationship Models}

\subsection{Translation of Plate Models to Entity Relationship Models}

In this section we propose a technique to transform a given directed graphical model in plate notation into a well-formed database model. This is done in three steps:
\begin{enumerate}
\item Transform multidimensional variables into their components. The resulting model is called an atomic plate model (APM).
\item\label{itm:apm2erm} Convert the APM into an ERM.
\item Reduce the ERM to avoid translation artifacts.
\end{enumerate}
The translation of APMs to ERMs is based on the mapping from plate models to directed acyclic probabilistic entity-relationship (DAPER) models proposed by \textcite{heckerman2007probabilistic}. Although the authors showed that the mapping is possible for every plate model, they did not go into detail about the concrete form of the resulting DAPER models / ERMs. If the mapping is applied directly to arbitrary plate models, the resulting ERMs are often not well-formed.\footnote{Converting plate models containing multidimensional variables directly leads to database models containing non-atomic attributes or having implicit relationships by adding foreign key attributes. [TODO: explain better, mb example or separate section?]}

We extend the translation procedure by converting the plate model into an APM first, then map the APM to an ERM, and reduce the ERM afterwards. Applying this extended procedure produces well-formed ERMs. The following sections offer detailed explanations for all steps.

\subsubsection{Atomic Plate Models}

Plate models may contain multidimensional variables, such as vectors or matrices. To receive an APM, multidimensional variables are split into their components such that there is one variable for each component. A plate containing an indexed component variable represents the multidimensional variable in the APM. Figure~\ref{fig:pm2apm} shows the conversion of plate models containing a vector and a matrix variable, respectively. The multidimensional variables $\vec x$ and $X$ are converted into individual component variables $x_n$ and $x_{nm}$, surrounded by plates of the corresponding dimensionality.

\begin{figure}[p]
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/apm_vectors.tex}}
\caption{Conversion of plate models containing multidimensional variables to atomic plate models by modeling the components as individual variables. Subfigure (a) shows the conversion of an $|N|$ dimensional vector variable $\vec x$ to its components $x_n$. In (b), the $|N| \times |M|$ matrix $X$ is converted into a variable inside two plates, one for each dimension. Arrows are removed because they do not express conditional distributions anymore.}\label{fig:pm2apm}
\end{figure}

\begin{figure}[p]
\begin{minipage}[t]{0.49\linewidth}
	\begin{center}
		\subfloat[Original clustering plate model]{\label{fig:clustering_platemodel_original}
    	\scalebox{\tikzScale}{\adjustTikzSize \input{img/clustering_transformation_platemodel.tex}}}
	\end{center}
\end{minipage}
\hspace{0.0cm}
\begin{minipage}[t]{0.49\linewidth}
	\begin{center}
		\subfloat[Atomic clustering plate model]{\label{fig:clustering_platemodel_expanded}
		\scalebox{\tikzScale}{\adjustTikzSize \input{img/clustering_transformation_platemodel_expanded.tex}}}
	\end{center}
\end{minipage}\\
\caption{Transformation of the plate model for Dirichlet multinomial text clustering to the corresponding APM. The 'Words' plate represents the $|V|$ dimensional vocabulary domain of $\vec d_{nm}$, $\vec \mu_k$ and $\vec \beta_k$. The 'Clusters' plate is extended to $\vec z_n$, $\vec \pi$ and $\vec \alpha$.}
\label{fig:clustering_platemodels}
\end{figure}

Multidimensional variables are often used as parameters for conditional probability distributions.\footnote{Consider the parameter $\vec \mu$ of a multinomial distribution that contains the probability for each possible outcome or the covariance matrix $\Sigma$ of a multivariate gaussian distribution.} In that case one cannot decompose those variables without losing the relationship between their components concerning the generative process of the model. However, it is not necessary to preserve this relationship in the conversion process to a database model as it will not be used as a generative model anymore. We thus leave out all the arrows after the conversion process to explicitly state that they may not represent conditional probability distributions in the APM.

Figure~\ref{fig:clustering_platemodels} illustrates the conversion procedure on the plate model for Dirichlet Multinomial text clustering (see Example~\ref{ex:clustering-pm}, page~\pageref{ex:clustering-pm}). The $|V|$ dimensional vocabulary domain 'Words' of the vector variables $\vec d_{nm}$, $\vec \mu_k$ and $\vec \beta_k$ is now made explicit and the 'Clusters' plate is extended to the $|K|$ dimensional vector variables $\vec z_n$, $\vec \pi$ and $\vec \alpha$.

\subsubsection{Translation of Atomic Plate Models to Entitiy Relationship Models}

\textcite{heckerman2007probabilistic} proposed a mapping from plate models to DAPER models. DAPER models are essentially ERMs that may contain probabilistic dependencies between attributes of entity classes. They can be expanded to a directed graphical model given a skeleton\footnote{A skeleton of an ERM is a specification of the entity and relationship classes associated with a specific database.}.

We adopt this mapping to produce ERMs instead of DAPER models by leaving out the probabilistic dependencies between attributes during the translation process. Additionally we show some special cases of model constraints and their influence on the resulting ERM. The mapping is as follows:

\begin{description}
\item[Translate plates to entity types.] Each plate is represented as an entity type. Usually there is an index set associated with each plate. The cardinality of this set states how many entities of the given type will be present in the database. Each entity type gets an artificial key (ID). Figure~\ref{fig:pm2erm_uno_local} illustrates the translation of a plate representing $n$ Objects to the 'Object' entity type.

\item[Translate plate intersections to relationships.] In general, plate intersections represent many to many relationships between the corresponding entity types. [TODO: exact cardinality? see \#14] In contrast to the original mapping we translate all relationships into association entities. This allows a generic translation procedure that can easily be used for n-ary relationships. Figure~\ref{fig:pm2erm_bi_noconstraints} shows the translation of two entity types having a binary relationship.

\item[Translate variables to attributes.] Variables will be translated to attributes of either entity types or relationships, depending on the number of plates surrounding them. If a variable is surrounded by exactly one plate, the entity type of that plate gets an additional attribute representing this variable (see Figure~\ref{fig:pm2erm_uno_local}). If a variable lies inside multiple plates, it becomes an attribute of the corresponding association entity (see Figure~\ref{fig:pm2erm_bi_noconstraints}). Variables that are associated with no plate are assigned to an artificial entity type called 'Global' (see Figure~\ref{fig:pm2erm_uno_global}). As 'Global' does not have a primary key, there is only one entity. [TODO: are entity types w/o keys possible?]

\item[Translate nested plates to one to many relationships.] If a plate is nested in another plate, the resulting relationship has a one to many cardinality instead of many to many. For each entity from the covering plate there may exist many covered entities. We adjust this mapping rule to the concept of association entity types as demonstrated in Figure~\ref{fig:pm2erm_covered_1}. If a plate covers another plate, it will not have a weak relationship to the association entity type.\footnote{In case of binary relationships like in Figure~\ref{fig:pm2erm_covered_1} this will result in a malformed ERM. A weak entity with only one weak relationship is simply an extension of the original entity. It will be merged in the reduction step (see Section~\ref{sec:erm_reduction}).} It then does no longer extend the key of the association entity.
\end{description}

\begin{figure}
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/pm2erm_uno_local.tex}}
\caption{Conversion of a plate containing a variable $x_n$ to an entity type having an artificial key ID and an attribute $x$.}\label{fig:pm2erm_uno_local}
\end{figure}

\begin{figure}
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/pm2erm_bi_noconstraints.tex}}
\caption{Conversion of a plate intersection to an association entity of a many to many relationship. The variable $z_{nm}$ residing in the intersection is represented as the attribute $z$ of the association entity.}\label{fig:pm2erm_bi_noconstraints}
\end{figure}

\begin{figure}
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/pm2erm_uno_global.tex}}
\caption{Conversion of a single variable that is not located in any plate. It will be associated with an artificial entity type called 'Global'.}\label{fig:pm2erm_uno_global}
\end{figure}

\textbf{APM $\Rightarrow$ ERM}
\begin{enumerate}
\item[$\checkmark$] variables $\Rightarrow$ attributes 
\item[$\checkmark$] Variables that are not inside of a plate need to be assigned to an artificial entity type called 'Global' (\cite{heckerman2007probabilistic})
\item[$\checkmark$] plates $\Rightarrow$ entity types 
\item[$\checkmark$] plate intersections $\Rightarrow$ relationships (association entitites)
\item[$\checkmark$] nested plates affect translation
\item[$\bullet$] constraints affect translation
\item[$\bullet$] covered / overlapping with the same index range / name are translated as many to many self relationships
\end{enumerate}

\begin{figure}
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/pm2erm_covered_1.tex}}
\caption{Conversion of a covered plate to an association entity.}\label{fig:pm2erm_covered_1}
\end{figure}

\begin{figure}
\centering
\scalebox{\tikzScale}{\adjustTikzSize \input{img/pm2erm_bi_constraints.tex}}
\caption{Conversion of a plate intersection to an association entity given a variable constraint.}\label{fig:pm2erm_bi_constraints}
\end{figure}

\subsubsection{Reduction of Translated Entity Relationship Models}
\label{sec:erm_reduction}

\begin{itemize}
\item convert association entitites w/o attributes to relationships
\item convert degenerated 1:n relationships (expressed as 1:1 weak : 1:n)
\item merge 1:1 relationship entities
\item merge relationships
\end{itemize}

\subsection{Matching Domain Data Models and Translated Entity Relationship Models}

\begin{itemize}
\item domain data model given
\item set of machine learning algorithm data models available
\item match generic machine learning algorithm data model template
\item framework will select corresponding implementation and fill out the missing data (statistical inference)
\end{itemize}
